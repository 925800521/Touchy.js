/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function p(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),i[a]={name:b,callback:c})}function o(a){this.id=a;this.points=[];this.callbacks={start:[],move:[],end:[]}}function f(a){this.fingers=!a?[]:q(a,function(a){return new o(a)});this.callbacks={start:[],move:[],end:[]}}function l(a,b){return q(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function m(a,b){function c(a){var c=[];d(a,function(a){var b=new o(a.id);b.points.push(a);
c.push([b,a]);k.add(b)});d(c,function(a){b.any&&b.any(k,a[0]);a[0].trigger("start",a[1])});k.trigger("start",a)}function g(a){var b=[];d(a,function(a){var j=k.get(a.id);j.points.push(a);b.push([j,a])});d(b,function(a){a[0].trigger("move",a[1])});k.trigger("move",a)}function s(a){var b=[];d(a,function(a){var j=k.get(a.id);j.points.push(a);b.push([j,a]);k.remove(j)});d(b,function(a){a[0].trigger("end",a[1])});k.trigger("end",a)}function e(a){var b=[];d(a,function(a){var j=h.get(a.id);j.points.push(a);
b.push([j,a])});d(b,function(a){a[0].trigger("move",a[1])});h.trigger("move",a)}function i(a,b){n();var c=t(b,function(b){var c=!0;d(a,function(a){a.id==b.id&&(c=!1)});return c});m(c)}function m(a){if(0!=a.length){h=new f;var b=[];d(a,function(a){var c=new o(a.id);c.points.push(a);b.push([c,a]);h.add(c)});q();d(b,function(a){a[0].trigger("start",a[1])});h.trigger("start",a)}}function n(){if(h){var a=[];d(h.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",
b.point)});h.trigger("end",a);h=null}}function q(){var a=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[h.fingers.length]];a&&a.apply(window,[h].concat(h.fingers))}"function"==typeof b&&(b={any:b});var k=new f,h;p(a,"touchstart",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,a.timeStamp);c(a);n();m(b)});p(a,"touchmove",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,a.timeStamp);g(a);e(a,b)});p(a,"touchend",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,
a.timeStamp);s(a);i(a,b)})}var d=function(){return Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var g=0,d=a.length;g<d;g++)g in a&&b.call(c,a[g],g,a)}}(),r=function(){return Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){for(var c=c||0,g=a.length;c<g;c++)if(c in a&&a[c]===b)return c;return-1}}(),q=function(){return Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,
b,c){for(var g=a.length,d=Array(g),e=0;e<g;e++)e in a&&(d[e]=b.call(c,a[e],e,a));return d}}(),t=function(){return Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,b,c)}:function(a,b,c){for(var d=[],f,e=0,i=a.length;e<i;e++)f=a[e],e in a&&b.call(c,f,e,a)&&d.push(f);return d}}(),i={};o.prototype.on=function(a,b){this.callbacks[a].push(b)};o.prototype.trigger=function(a,b){var c=this;d(this.callbacks[a],function(a){a.call(c,b)})};f.prototype.add=function(a){-1==r(this.fingers,
a)&&this.fingers.push(a)};f.prototype.remove=function(a){a=r(this.fingers,a);-1!=a&&this.fingers.splice(a,1)};f.prototype.get=function(a){var b;d(this.fingers,function(c){c.id==a&&(b=c)});return b};f.prototype.has=function(a){var b=!1;d(this.fingers,function(c){c.id==a&&(b=!0)});return b};f.prototype.on=function(a,b){this.callbacks[a].push(b)};f.prototype.trigger=function(a,b){var c=this;d(this.callbacks[a],function(a){a.call(c,b)})};var n=function(a){a.preventDefault()};m.stopWindowBounce=function(){p(window,
"touchmove",n)};m.startWindowBounce=function(){var a=window;if(a.removeEventListener)a.removeEventListener("touchmove",n,!1);else if(a.detachEvent)for(var b in i)"touchmove"===i[b].name&&i[b].callback===n&&(a.detachEvent(b),delete i[b])};window.Touchy=m})();
