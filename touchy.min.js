/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function m(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&(a=a.attachEvent("on"+c,b),l[a]={name:c,callback:b})}function r(a,c){function b(a){var b=Array.prototype.slice.call(arguments,1);if(o[a])return o[a].apply(this,b)}var d=a.prototype,o=c.prototype,f,e;for(e in o)d[e]=o[e];d._super?(f=d._super,d._super=function(){f.call(this,arguments);b.call(this,arguments)}):d._super=b}function h(){this.onEvents={};this.onceEvents={}}function s(a){this._super("constructor");
this.id=a;this.points=[]}function t(a){this._super("constructor");this.fingers=!a?[]:B(a,function(a){return new s(a)})}function p(a,c){return B(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:c}})}function u(a,c){return[{id:c,x:a.pageX,y:a.pageY,time:a.timeStamp}]}function j(a,c,b){function d(a){var b;i&&(b=u(a,i),j(b),w(b,b),i=null);i=Math.random()+"";b=u(a,i);h(b);a=b;x();y(a)}function o(a){i&&(a=u(a,i),j(a),w(a,a),i=null)}function f(a){i&&(a=u(a,i),l(a),r(a,a))}function h(a){var c=
[];e(a,function(a){var b=new s(a.id);b.points.push(a);c.push([b,a]);k.fingers.push(b)});e(c,function(a){b.any&&b.any(k,a[0]);a[0].trigger("start",a[1])});k.trigger("start",a)}function l(a){var b=[];e(a,function(a){var c=k.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});k.trigger("move",a)}function j(a){var b=[];e(a,function(a){var c=k.get(a.id);c.points.push(a);b.push([c,a]);a=n(k.fingers,c);k.fingers.splice(a,1)});e(b,function(a){a[0].trigger("end",a[1])});
k.trigger("end",a)}function r(a){var b=[];e(a,function(a){var c=g.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});g.trigger("move",a)}function w(a,b){x();var c=C(b,function(b){var c=!0;e(a,function(a){a.id==b.id&&(c=!1)});return c});y(c)}function y(a){if(0!=a.length){g=new t;var c=[];e(a,function(a){var b=new s(a.id);b.points.push(a);c.push([b,a]);g.fingers.push(b)});var d=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[g.fingers.length]];d&&d.apply(window,[g].concat(g.fingers));
e(c,function(a){a[0].trigger("start",a[1])});g.trigger("start",a)}}function x(){if(g){var a=[];e(g.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",c)});g.trigger("end",a);g=null}}"undefined"==typeof b&&(b=c,c=!1);"function"==typeof b&&(b={any:b});for(var z in v)if(z in b){var A=v[z](b[z]),q;for(q in A)b[q]=q in b?function(a,b){return function(){a.call(this,arguments);b.call(this,arguments)}}(b[q],A[q]):A[q]}var k=new t,g,i;m(a,"touchstart",function(a){var b=
p(a.touches,a.timeStamp),a=p(a.changedTouches,a.timeStamp);h(a);x();y(b)});m(a,"touchmove",function(a){var b=p(a.touches,a.timeStamp),a=p(a.changedTouches,a.timeStamp);l(a);r(a,b)});m(a,"touchend",function(a){var b=p(a.touches,a.timeStamp),a=p(a.changedTouches,a.timeStamp);j(a);w(a,b)});c&&(m(a,"mousedown",d),m(a,"mouseup",o),m(a,"mousemove",f))}var e=function(){return Array.prototype.forEach?function(a,c,b){Array.prototype.forEach.call(a,c,b)}:function(a,c,b){for(var d=0,e=a.length;d<e;d++)d in a&&
c.call(b,a[d],d,a)}}(),n=function(){return Array.prototype.indexOf?function(a,c,b){return Array.prototype.indexOf.call(a,c,b)}:function(a,c,b){for(var b=b||0,d=a.length;b<d;b++)if(b in a&&a[b]===c)return b;return-1}}(),B=function(){return Array.prototype.map?function(a,c,b){return Array.prototype.map.call(a,c,b)}:function(a,c,b){for(var d=a.length,e=Array(d),f=0;f<d;f++)f in a&&(e[f]=c.call(b,a[f],f,a));return e}}(),C=function(){return Array.prototype.filter?function(a,c,b){return Array.prototype.filter.call(a,
c,b)}:function(a,c,b){for(var d=[],e,f=0,h=a.length;f<h;f++)e=a[f],f in a&&c.call(b,e,f,a)&&d.push(e);return d}}(),l={};h.prototype.on=function(a,c){if(c){if(a in this.onEvents){var b=n(this.onEvents[a],c);if(-1!=b)return}else this.onEvents[a]=[];a in this.onceEvents&&(b=n(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1));this.onEvents[a].push(c)}};h.prototype.once=function(a,c){if(c){if(a in this.onceEvents){var b=n(this.onceEvents[a],c);if(-1!=b)return}else this.onceEvents[a]=[];a in this.onEvents&&
(b=n(this.onEvents[a],c),-1!=b&&this.onEvents.splice(b,1));this.onceEvents[a].push(c)}};h.prototype.off=function(a,c){if(c){if(a in this.onEvents){var b=n(this.onEvents[a],c);if(-1!=b){this.onEvents.splice(b,1);return}}a in this.onceEvents&&(b=n(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1))}};h.prototype.trigger=function(a){for(var c=Array.prototype.slice.call(arguments,1),b=(this.onEvents[a]||[]).concat(this.onceEvents[a]||[]),d;d=b.shift();)d.apply(this,c)};r(s,h);r(t,h);t.prototype.get=
function(a){var c;e(this.fingers,function(b){b.id==a&&(c=b)});return c};var v={};j.plugin=function(a,c){if(a in v)throw"Touchy: "+a+" plugin already defined";v[a]=c};(function(){var a=function(a){a.preventDefault()};j.stopWindowBounce=function(){m(window,"touchmove",a)};j.startWindowBounce=function(){var c=window;if(c.removeEventListener)c.removeEventListener("touchmove",a,!1);else if(c.detachEvent)for(var b in l)"touchmove"===l[b].name&&l[b].callback===a&&(c.detachEvent(b),delete l[b])}})();window.Touchy=
j;"function"==typeof jQuery&&(jQuery.fn.touchy=function(){var a=Array.prototype.slice.call(arguments);this.each(function(){var c=a.slice();c.unshift(this);j.apply(window,c)})})})();
