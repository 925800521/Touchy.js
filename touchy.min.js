/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function o(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),h[a]={name:b,callback:c})}function s(a,b){function c(a){var b=Array.prototype.slice.call(arguments,1);if(l[a])return l[a].apply(this,b)}var d=a.prototype,l=b.prototype,f,e;for(e in l)d[e]=l[e];d._super?(f=d._super,d._super=function(){f.call(this,arguments);c.call(this,arguments)}):d._super=c}function i(){this.onEvents={};this.onceEvents={}}function p(a){this._super("constructor");
this.id=a;this.points=[]}function q(a){this._super("constructor");this.fingers=!a?[]:t(a,function(a){return new p(a)})}function m(a,b){return t(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function n(a,b){function c(a){var c=[];e(a,function(a){var b=new p(a.id);b.points.push(a);c.push([b,a]);j.fingers.push(b)});e(c,function(a){b.any&&b.any(j,a[0]);a[0].trigger("start",a[1])});j.trigger("start",a)}function d(a){var b=[];e(a,function(a){var c=j.get(a.id);c.points.push(a);b.push([c,
a])});e(b,function(a){a[0].trigger("move",a[1])});j.trigger("move",a)}function l(a){var b=[];e(a,function(a){var c=j.get(a.id);c.points.push(a);b.push([c,a]);this.fingers.splice(k(j.fingers,c),1)});e(b,function(a){a[0].trigger("end",a[1])});j.trigger("end",a)}function f(a){var b=[];e(a,function(a){var c=g.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});g.trigger("move",a)}function i(a,b){n();var c=u(b,function(b){var c=!0;e(a,function(a){a.id==b.id&&(c=!1)});
return c});h(c)}function h(a){if(0!=a.length){g=new q;var c=[];e(a,function(a){var b=new p(a.id);b.points.push(a);c.push([b,a]);g.fingers.push(b)});var d=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[g.fingers.length]];d&&d.apply(window,[g].concat(g.fingers));e(c,function(a){a[0].trigger("start",a[1])});g.trigger("start",a)}}function n(){if(g){var a=[];e(g.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",b.point)});g.trigger("end",a);g=null}}"function"==
typeof b&&(b={any:b});var j=new q,g;o(a,"touchstart",function(a){var b=m(a.touches,a.timeStamp),a=m(a.changedTouches,a.timeStamp);c(a);n();h(b)});o(a,"touchmove",function(a){var b=m(a.touches,a.timeStamp),a=m(a.changedTouches,a.timeStamp);d(a);f(a,b)});o(a,"touchend",function(a){var b=m(a.touches,a.timeStamp),a=m(a.changedTouches,a.timeStamp);l(a);i(a,b)})}var e=function(){return Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=0,e=a.length;d<
e;d++)d in a&&b.call(c,a[d],d,a)}}(),k=function(){return Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){for(var c=c||0,d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1}}(),t=function(){return Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=0;f<d;f++)f in a&&(e[f]=b.call(c,a[f],f,a));return e}}(),u=function(){return Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=[],e,f=0,h=a.length;f<h;f++)e=a[f],f in a&&b.call(c,e,f,a)&&d.push(e);return d}}(),h={};i.prototype.on=function(a,b){if(b){if(a in this.onEvents){var c=k(this.onEvents[a],b);if(-1!=c)return}else this.onEvents[a]=[];a in this.onceEvents&&(c=k(this.onceEvents[a],b),-1!=c&&this.onceEvents.splice(c,1));this.onEvents[a].push(b)}};i.prototype.once=function(a,b){if(b){if(a in this.onceEvents){var c=k(this.onceEvents[a],b);if(-1!=c)return}else this.onceEvents[a]=[];a in this.onEvents&&
(c=k(this.onEvents[a],b),-1!=c&&this.onEvents.splice(c,1));this.onceEvents[a].push(b)}};i.prototype.off=function(a,b){if(b){if(a in this.onEvents){var c=k(this.onEvents[a],b);if(-1!=c){this.onEvents.splice(c,1);return}}a in this.onceEvents&&(c=k(this.onceEvents[a],b),-1!=c&&this.onceEvents.splice(c,1))}};i.prototype.trigger=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=(this.onEvents[a]||[]).concat(this.onceEvents[a]||[]),d;d=c.shift();)d.apply(this,b)};s(p,i);s(q,i);q.prototype.get=
function(a){var b;e(this.fingers,function(c){c.id==a&&(b=c)});return b};var r=function(a){a.preventDefault()};n.stopWindowBounce=function(){o(window,"touchmove",r)};n.startWindowBounce=function(){var a=window;if(a.removeEventListener)a.removeEventListener("touchmove",r,!1);else if(a.detachEvent)for(var b in h)"touchmove"===h[b].name&&h[b].callback===r&&(a.detachEvent(b),delete h[b])};window.Touchy=n})();
