/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(h){function n(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&(a=a.attachEvent("on"+c,b),m[a]={name:c,callback:b})}function s(a,c){function b(a){var b=Array.prototype.slice.call(arguments,1);if(p[a])return p[a].apply(this,b)}var d=a.prototype,p=c.prototype,f,e;for(e in p)d[e]=p[e];d._super?(f=d._super,d._super=function(){f.call(this,arguments);b.call(this,arguments)}):d._super=b}function j(){this.onEvents={};this.onceEvents={}}function u(a){this._super("constructor");
this.id=a;this.points=[]}function v(a){this._super("constructor");this.fingers=!a?[]:C(a,function(a){return new u(a)})}function q(a,c){return C(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:c}})}function w(a,c){return[{id:c,x:a.pageX,y:a.pageY,time:a.timeStamp}]}function k(a,c,b){function d(a){var b;i&&(b=w(a,i),k(b),y(b,b),i=null);i=Math.random()+"";b=w(a,i);j(b);a=b;z();A(a)}function p(a){i&&(a=w(a,i),k(a),y(a,a),i=null)}function f(a){i&&(a=w(a,i),m(a),s(a,a))}function j(a){var c=
[];e(a,function(a){var b=new u(a.id);b.points.push(a);c.push([b,a]);l.fingers.push(b)});e(c,function(a){b.any&&b.any(l,a[0]);a[0].trigger("start",a[1])});l.trigger("start",a)}function m(a){var b=[];e(a,function(a){var c=l.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});l.trigger("move",a)}function k(a){var b=[];e(a,function(a){var c=l.get(a.id);c.points.push(a);b.push([c,a]);a=o(l.fingers,c);l.fingers.splice(a,1)});e(b,function(a){a[0].trigger("end",a[1])});
l.trigger("end",a)}function s(a){var b=[];e(a,function(a){var c=g.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});g.trigger("move",a)}function y(a,b){z();var c=D(b,function(b){var c=!0;e(a,function(a){a.id==b.id&&(c=!1)});return c});A(c)}function A(a){if(0!=a.length){g=new v;var c=[];e(a,function(a){var b=new u(a.id);b.points.push(a);c.push([b,a]);g.fingers.push(b)});var d=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[g.fingers.length]];d&&d.apply(h,[g].concat(g.fingers));
e(c,function(a){a[0].trigger("start",a[1])});g.trigger("start",a)}}function z(){if(g){var a=[];e(g.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",c)});g.trigger("end",a);g=null}}"undefined"==typeof b&&(b=c,c=!1);"function"==typeof b&&(b={any:b});for(var B in x)if(B in b){var r=x[B](a,b[B]);"function"==typeof r&&(r={any:r});for(var t in r)b[t]=t in b?function(a,b){return function(){a.call(this,arguments);b.call(this,arguments)}}(b[t],r[t]):r[t]}var l=
new v,g,i;n(a,"touchstart",function(a){var b=q(a.touches,a.timeStamp),a=q(a.changedTouches,a.timeStamp);j(a);z();A(b)});n(a,"touchmove",function(a){var b=q(a.touches,a.timeStamp),a=q(a.changedTouches,a.timeStamp);m(a);s(a,b)});n(a,"touchend",function(a){var b=q(a.touches,a.timeStamp),a=q(a.changedTouches,a.timeStamp);k(a);y(a,b)});c&&(n(a,"mousedown",d),n(a,"mouseup",p),n(a,"mousemove",f))}var h=h||{},e=function(){return Array.prototype.forEach?function(a,c,b){Array.prototype.forEach.call(a,c,b)}:
function(a,c,b){for(var d=0,e=a.length;d<e;d++)d in a&&c.call(b,a[d],d,a)}}(),o=function(){return Array.prototype.indexOf?function(a,c,b){return Array.prototype.indexOf.call(a,c,b)}:function(a,c,b){for(var b=b||0,d=a.length;b<d;b++)if(b in a&&a[b]===c)return b;return-1}}(),C=function(){return Array.prototype.map?function(a,c,b){return Array.prototype.map.call(a,c,b)}:function(a,c,b){for(var d=a.length,e=Array(d),f=0;f<d;f++)f in a&&(e[f]=c.call(b,a[f],f,a));return e}}(),D=function(){return Array.prototype.filter?
function(a,c,b){return Array.prototype.filter.call(a,c,b)}:function(a,c,b){for(var d=[],e,f=0,h=a.length;f<h;f++)e=a[f],f in a&&c.call(b,e,f,a)&&d.push(e);return d}}(),m={};j.prototype.on=function(a,c){if(c){if(a in this.onEvents){var b=o(this.onEvents[a],c);if(-1!=b)return}else this.onEvents[a]=[];a in this.onceEvents&&(b=o(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1));this.onEvents[a].push(c)}};j.prototype.once=function(a,c){if(c){if(a in this.onceEvents){var b=o(this.onceEvents[a],
c);if(-1!=b)return}else this.onceEvents[a]=[];a in this.onEvents&&(b=o(this.onEvents[a],c),-1!=b&&this.onEvents.splice(b,1));this.onceEvents[a].push(c)}};j.prototype.off=function(a,c){if(c){if(a in this.onEvents){var b=o(this.onEvents[a],c);if(-1!=b){this.onEvents.splice(b,1);return}}a in this.onceEvents&&(b=o(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1))}};j.prototype.trigger=function(a){for(var c=Array.prototype.slice.call(arguments,1),b=(this.onEvents[a]||[]).concat(this.onceEvents[a]||
[]),d;d=b.shift();)d.apply(this,c)};s(u,j);s(v,j);v.prototype.get=function(a){var c;e(this.fingers,function(b){b.id==a&&(c=b)});return c};var x={};k.plugin=function(a,c){if(a in x)throw"Touchy: "+a+" plugin already defined";x[a]=c};(function(){var a=function(a){a.preventDefault()};k.stopWindowBounce=function(){n(h,"touchmove",a)};k.startWindowBounce=function(){var c=h;if(c.removeEventListener)c.removeEventListener("touchmove",a,!1);else if(c.detachEvent)for(var b in m)"touchmove"===m[b].name&&m[b].callback===
a&&(c.detachEvent(b),delete m[b])}})();h.Touchy=k;"function"==typeof h.jQuery&&(h.jQuery.fn.touchy=function(){var a=Array.prototype.slice.call(arguments);this.each(function(){var c=a.slice();c.unshift(this);k.apply(h,c)})})})(window);
