/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function l(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&(a=a.attachEvent("on"+c,b),k[a]={name:c,callback:b})}function q(a,c){function b(a){var b=Array.prototype.slice.call(arguments,1);if(o[a])return o[a].apply(this,b)}var d=a.prototype,o=c.prototype,f,e;for(e in o)d[e]=o[e];d._super?(f=d._super,d._super=function(){f.call(this,arguments);b.call(this,arguments)}):d._super=b}function h(){this.onEvents={};this.onceEvents={}}function r(a){this._super("constructor");
this.id=a;this.points=[]}function s(a){this._super("constructor");this.fingers=!a?[]:x(a,function(a){return new r(a)})}function p(a,c){return x(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:c}})}function t(a,c){return[{id:c,x:a.pageX,y:a.pageY,time:a.timeStamp}]}function m(a,c,b){function d(a){var b;i&&(b=t(a,i),m(b),u(b,b),i=null);i=Math.random()+"";b=t(a,i);h(b);a=b;v();w(a)}function o(a){i&&(a=t(a,i),m(a),u(a,a),i=null)}function f(a){i&&(a=t(a,i),k(a),q(a,a))}function h(a){var c=
[];e(a,function(a){var b=new r(a.id);b.points.push(a);c.push([b,a]);j.fingers.push(b)});e(c,function(a){b.any&&b.any(j,a[0]);a[0].trigger("start",a[1])});j.trigger("start",a)}function k(a){var b=[];e(a,function(a){var c=j.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});j.trigger("move",a)}function m(a){var b=[];e(a,function(a){var c=j.get(a.id);c.points.push(a);b.push([c,a]);a=n(j.fingers,c);j.fingers.splice(a,1)});e(b,function(a){a[0].trigger("end",a[1])});
j.trigger("end",a)}function q(a){var b=[];e(a,function(a){var c=g.get(a.id);c.points.push(a);b.push([c,a])});e(b,function(a){a[0].trigger("move",a[1])});g.trigger("move",a)}function u(a,b){v();var c=y(b,function(b){var c=!0;e(a,function(a){a.id==b.id&&(c=!1)});return c});w(c)}function w(a){if(0!=a.length){g=new s;var c=[];e(a,function(a){var b=new r(a.id);b.points.push(a);c.push([b,a]);g.fingers.push(b)});var d=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[g.fingers.length]];d&&d.apply(window,[g].concat(g.fingers));
e(c,function(a){a[0].trigger("start",a[1])});g.trigger("start",a)}}function v(){if(g){var a=[];e(g.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",b.point)});g.trigger("end",a);g=null}}"undefined"==typeof b&&(b=c,c=!1);"function"==typeof b&&(b={any:b});var j=new s,g,i;l(a,"touchstart",function(a){var b=p(a.touches,a.timeStamp),a=p(a.changedTouches,a.timeStamp);h(a);v();w(b)});l(a,"touchmove",function(a){var b=p(a.touches,a.timeStamp),a=p(a.changedTouches,
a.timeStamp);k(a);q(a,b)});l(a,"touchend",function(a){var b=p(a.touches,a.timeStamp),a=p(a.changedTouches,a.timeStamp);m(a);u(a,b)});c&&(l(a,"mousedown",d),l(a,"mouseup",o),l(a,"mousemove",f))}var e=function(){return Array.prototype.forEach?function(a,c,b){Array.prototype.forEach.call(a,c,b)}:function(a,c,b){for(var d=0,e=a.length;d<e;d++)d in a&&c.call(b,a[d],d,a)}}(),n=function(){return Array.prototype.indexOf?function(a,c,b){return Array.prototype.indexOf.call(a,c,b)}:function(a,c,b){for(var b=
b||0,d=a.length;b<d;b++)if(b in a&&a[b]===c)return b;return-1}}(),x=function(){return Array.prototype.map?function(a,c,b){return Array.prototype.map.call(a,c,b)}:function(a,c,b){for(var d=a.length,e=Array(d),f=0;f<d;f++)f in a&&(e[f]=c.call(b,a[f],f,a));return e}}(),y=function(){return Array.prototype.filter?function(a,c,b){return Array.prototype.filter.call(a,c,b)}:function(a,c,b){for(var d=[],e,f=0,h=a.length;f<h;f++)e=a[f],f in a&&c.call(b,e,f,a)&&d.push(e);return d}}(),k={};h.prototype.on=function(a,
c){if(c){if(a in this.onEvents){var b=n(this.onEvents[a],c);if(-1!=b)return}else this.onEvents[a]=[];a in this.onceEvents&&(b=n(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1));this.onEvents[a].push(c)}};h.prototype.once=function(a,c){if(c){if(a in this.onceEvents){var b=n(this.onceEvents[a],c);if(-1!=b)return}else this.onceEvents[a]=[];a in this.onEvents&&(b=n(this.onEvents[a],c),-1!=b&&this.onEvents.splice(b,1));this.onceEvents[a].push(c)}};h.prototype.off=function(a,c){if(c){if(a in this.onEvents){var b=
n(this.onEvents[a],c);if(-1!=b){this.onEvents.splice(b,1);return}}a in this.onceEvents&&(b=n(this.onceEvents[a],c),-1!=b&&this.onceEvents.splice(b,1))}};h.prototype.trigger=function(a){for(var c=Array.prototype.slice.call(arguments,1),b=(this.onEvents[a]||[]).concat(this.onceEvents[a]||[]),d;d=b.shift();)d.apply(this,c)};q(r,h);q(s,h);s.prototype.get=function(a){var c;e(this.fingers,function(b){b.id==a&&(c=b)});return c};(function(){var a=function(a){a.preventDefault()};m.stopWindowBounce=function(){l(window,
"touchmove",a)};m.startWindowBounce=function(){var c=window;if(c.removeEventListener)c.removeEventListener("touchmove",a,!1);else if(c.detachEvent)for(var b in k)"touchmove"===k[b].name&&k[b].callback===a&&(c.detachEvent(b),delete k[b])}})();window.Touchy=m})();
