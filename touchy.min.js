/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function p(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),h[a]={name:b,callback:c})}function o(a){this.id=a;this.points=[];this.callbacks={start:[],move:[],end:[]}}function i(a){this.fingers=!a?[]:q(a,function(a){return new o(a)});this.callbacks={start:[],move:[],end:[]}}function l(a,b){return q(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function m(a,b){function c(a){var c=[];d(a,function(a){var b=new o(a.id);b.points.push(a);
c.push([b,a]);k.add(b)});d(c,function(a){b.any&&b.any(k,a[0]);a[0].trigger("start",a[1])});k.trigger("start",a)}function f(a){var b=[];d(a,function(a){var j=k.get(a.id);j.points.push(a);b.push([j,a])});d(b,function(a){a[0].trigger("move",a[1])});k.trigger("move",a)}function s(a){var b=[];d(a,function(a){var j=k.get(a.id);j.points.push(a);b.push([j,a]);k.remove(j)});d(b,function(a){a[0].trigger("end",a[1])});k.trigger("end",a)}function e(a){var b=[];d(a,function(a){var j=g.get(a.id);j.points.push(a);
b.push([j,a])});d(b,function(a){a[0].trigger("move",a[1])});g.trigger("move",a)}function h(a,b){n();var c=t(b,function(b){var c=!0;d(a,function(a){a.id==b.id&&(c=!1)});return c});m(c)}function m(a){if(0!=a.length){g=new i;var b=[];d(a,function(a){var c=new o(a.id);c.points.push(a);b.push([c,a]);g.add(c)});q();d(b,function(a){a[0].trigger("start",a[1])});g.trigger("start",a)}}function n(){if(g){var a=[];d(g.fingers,function(b){var c=b.points[b.points.length-1];b.points.push(c);a.push(c);b.trigger("end",
b.point)});g.trigger("end",a);g=null}}function q(){var a=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[g.fingers.length]];a&&a.apply(window,[g].concat(g.fingers))}"function"==typeof b&&(b={any:b});var k=new i,g;p(a,"touchstart",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,a.timeStamp);c(a);n();m(b)});p(a,"touchmove",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,a.timeStamp);f(a);e(a,b)});p(a,"touchend",function(a){var b=l(a.touches,a.timeStamp),a=l(a.changedTouches,
a.timeStamp);s(a);h(a,b)})}var d=function(){return Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var f=0,d=a.length;f<d;f++)f in a&&b.call(c,a[f],f,a)}}(),r=function(){return Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){for(var c=c||0,f=a.length;c<f;c++)if(c in a&&a[c]===b)return c;return-1}}(),q=function(){return Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,
b,c){for(var f=a.length,d=Array(f),e=0;e<f;e++)e in a&&(d[e]=b.call(c,a[e],e,a));return d}}(),t=function(){return Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,b,c)}:function(a,b,c){for(var d=[],h,e=0,i=a.length;e<i;e++)h=a[e],e in a&&b.call(c,h,e,a)&&d.push(h);return d}}(),h={};o.prototype.on=function(a,b){this.callbacks[a].push(b)};o.prototype.trigger=function(a,b){var c=this;d(this.callbacks[a],function(a){a.call(c,b)})};i.prototype.add=function(a){-1==r(this.fingers,
a)&&this.fingers.push(a)};i.prototype.remove=function(a){a=r(this.fingers,a);-1!=a&&this.fingers.splice(a,1)};i.prototype.get=function(a){var b;d(this.fingers,function(c){c.id==a&&(b=c)});return b};i.prototype.on=function(a,b){this.callbacks[a].push(b)};i.prototype.trigger=function(a,b){var c=this;d(this.callbacks[a],function(a){a.call(c,b)})};var n=function(a){a.preventDefault()};m.stopWindowBounce=function(){p(window,"touchmove",n)};m.startWindowBounce=function(){var a=window;if(a.removeEventListener)a.removeEventListener("touchmove",
n,!1);else if(a.detachEvent)for(var b in h)"touchmove"===h[b].name&&h[b].callback===n&&(a.detachEvent(b),delete h[b])};window.Touchy=m})();
