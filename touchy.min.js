/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function i(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),g[a]={name:b,callback:c})}function j(){this.fingers=[]}function f(a){this.id=a;this.points=[];this.callbacks={start:[],move:[],end:[]}}function k(a){return function(b,c,d){this.points.push({x:b,y:c,time:d});this.trigger(a)}}function l(a,b){var c={},d=new j;i(a,"touchstart",function(a){Array.prototype.forEach.call(a.touches,function(h){if(!c[h.identifier]){var e=new f(h.identifier);
c[h.identifier]=e;d.add(e);b(e,d);e.startEvent(h.pageX,h.pageY,a.timeStamp)}})});i(a,"touchmove",function(a){Array.prototype.forEach.call(a.touches,function(b){c[b.identifier]&&c[b.identifier].moveEvent(b.pageX,b.pageY,a.timeStamp)})});i(a,"touchend",function(a){Array.prototype.forEach.call(a.changedTouches,function(b){if(c[b.identifier]){var e=c[b.identifier];d.remove(e);e.endEvent(b.pageX,b.pageY,a.timeStamp)}})})}Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<
d;c++)c in this&&a.call(b,this[c],c,this)});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1});var g={};j.prototype.count=function(){return this.fingers.length};j.prototype.add=function(a){-1==this.fingers.indexOf(a)&&this.fingers.push(a)};j.prototype.remove=function(a){a=this.fingers.indexOf(a);-1!=a&&this.fingers.splice(a,1)};f.prototype.on=function(a,b){this.callbacks[a].push(b)};f.prototype.trigger=
function(a){var b=this,c=b.points[b.points.length-1];this.callbacks[a].forEach(function(a){a.call(b,c)})};f.prototype.startEvent=k("start");f.prototype.moveEvent=k("move");f.prototype.endEvent=k("end");var m=function(a){a.preventDefault()};l.stopWindowBounce=function(){i(window,"touchmove",m)};l.startWindowBounce=function(){var a=window;if(a.removeEventListener)a.removeEventListener("touchmove",m,!1);else if(a.detachEvent)for(var b in g)"touchmove"===g[b].name&&g[b].callback===m&&(a.detachEvent(b),
delete g[b])};window.Touchy=l})();
