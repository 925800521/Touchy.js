/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function h(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),f[a]={name:b,callback:c})}function j(a){this.id=a;this.points=[];this.callbacks={start:[],move:[],end:[]}}function l(a){j.prototype[a+"Event"]=function(b){this.points.push(b);this.trigger(a)}}function g(a){this.fingers=!a?[]:a.map(function(a){return new j(a)});this.callbacks={start:[],move:[],end:[]}}function m(a){g.prototype[a+"Event"]=function(b){var c=this;b.forEach(function(b){c.fingers.forEach(function(c){if(c.id==
b.id)c[a+"Event"](b)})});this.trigger(a)}}function p(a,b){return Array.prototype.map.call(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function n(a,b){function c(a,c){var i=p(a[c?"changedTouches":"touches"],a.timeStamp),h=i.length,k=h!=f;i.forEach(function(a){var d=e.get(a.id);c?d&&(d.endEvent(a),e.remove(d)):d?d.moveEvent(a):(d=new j(a.id),e.add(d),b.any&&b.any(e,d),d.startEvent(a))});k||i.forEach(function(a){d.has(a.id)||(k=!0)});k||d.moveEvent(i);if(d&&(k||c))c||d.fingers.map(function(a){return a.points[a.points.length-
1]}),d.endEvent(i),d=null,f=0;k&&(d=new g(i.map(function(a){return a.id})),f=h,(h=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[f]])&&h.apply(window,[d].concat(d.fingers)),d.startEvent(i))}"function"==typeof b&&(b={any:b});var d,e=new g,f=0;h(a,"touchstart",function(a){c(a,!1)});h(a,"touchmove",function(a){c(a,!1)});h(a,"touchend",function(a){c(a,!0)})}Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)});Array.prototype.indexOf||
(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1});Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=this.length,d=Array(c),e=0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d});var f={};j.prototype.on=function(a,b){this.callbacks[a].push(b)};j.prototype.trigger=function(a){var b=this,c=b.points[b.points.length-1];this.callbacks[a].forEach(function(a){a.call(b,c)})};l("start");l("move");l("end");g.prototype.add=
function(a){-1==this.fingers.indexOf(a)&&this.fingers.push(a)};g.prototype.remove=function(a){a=this.fingers.indexOf(a);-1!=a&&this.fingers.splice(a,1)};g.prototype.count=function(){return this.fingers.length};g.prototype.get=function(a){var b;this.fingers.forEach(function(c){c.id==a&&(b=c)});return b};g.prototype.has=function(a){var b=!1;this.fingers.forEach(function(c){c.id==a&&(b=!0)});return b};g.prototype.on=function(a,b){this.callbacks[a].push(b)};g.prototype.trigger=function(a){var b=this,
c=b.fingers.map(function(a){return a.points[a.points.length-1]});this.callbacks[a].forEach(function(a){a.call(b,c)})};m("start");m("move");m("end");var o=function(a){a.preventDefault()};n.stopWindowBounce=function(){h(window,"touchmove",o)};n.startWindowBounce=function(){var a=window;if(a.removeEventListener)a.removeEventListener("touchmove",o,!1);else if(a.detachEvent)for(var b in f)"touchmove"===f[b].name&&f[b].callback===o&&(a.detachEvent(b),delete f[b])};window.Touchy=n})();
