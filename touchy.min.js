/*
	Touchy.js
	Socket-style finger management for touch events

	Jairaj Sethi
*/
(function(){function f(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),h[a]={name:b,callback:c})}function j(){this.fingers=[]}function g(a){this.id=a;this.points=[];this.callbacks={start:[],move:[],end:[]}}function m(a){g.prototype[a+"Event"]=function(b){this.points.push(b);this.trigger(a)}}function i(a){this.fingers=a.map(function(a){return new g(a)});this.callbacks={start:[],move:[],end:[]}}function n(a){i.prototype[a+"Event"]=function(b){var c=this;
b.forEach(function(b){c.fingers.forEach(function(c){if(c.id==b.id)c[a+"Event"](b)})});this.trigger(a)}}function k(a,b){return Array.prototype.map.call(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function l(a,b){var c={},d=new j;f(a,"touchstart",function(a){k(a.touches,a.timeStamp).forEach(function(a){if(!c[a.id]){var e=new g(a.id);c[a.id]=e;d.add(e);b(e,d);e.startEvent(a)}})});f(a,"touchmove",function(a){k(a.touches,a.timeStamp).forEach(function(a){c[a.id]&&c[a.id].moveEvent(a)})});
f(a,"touchend",function(a){k(a.changedTouches,a.timeStamp).forEach(function(a){if(c[a.id]){var b=c[a.id];d.remove(b);b.endEvent(a)}})})}Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1});Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=this.length,d=Array(c),
e=0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d});var h={};j.prototype.count=function(){return this.fingers.length};j.prototype.add=function(a){-1==this.fingers.indexOf(a)&&this.fingers.push(a)};j.prototype.remove=function(a){a=this.fingers.indexOf(a);-1!=a&&this.fingers.splice(a,1)};g.prototype.on=function(a,b){this.callbacks[a].push(b)};g.prototype.trigger=function(a){var b=this,c=b.points[b.points.length-1];this.callbacks[a].forEach(function(a){a.call(b,c)})};m("start");m("move");
m("end");i.prototype.has=function(a){var b=!1;this.fingers.forEach(function(c){c.id==a&&(b=!0)});return b};i.prototype.on=function(a,b){this.callbacks[a].push(b)};i.prototype.trigger=function(a){var b=this,c=b.fingers.map(function(a){return a.points[a.points.length-1]});this.callbacks[a].forEach(function(a){a.call(b,c)})};n("start");n("move");n("end");l.multi=function(a,b){function c(a,c){var f=k(a[c?"changedTouches":"touches"],a.timeStamp),h=f.length,g=h!=e;g||f.forEach(function(a){d.has(a.id)||
(g=!0)});g||d.moveEvent(f);if(d&&(g||c))c||d.fingers.map(function(a){return a.points[a.points.length-1]}),d.endEvent(f),d=null,e=0;g&&(d=new i(f.map(function(a){return a.id})),e=h,(h=b[{1:"one",2:"two",3:"three",4:"four",5:"five"}[e]])&&h(d),d.startEvent(f))}var d,e=0;f(a,"touchstart",function(a){c(a,!1)});f(a,"touchmove",function(a){c(a,!1)});f(a,"touchend",function(a){c(a,!0)})};var o=function(a){a.preventDefault()};l.stopWindowBounce=function(){f(window,"touchmove",o)};l.startWindowBounce=function(){var a=
window;if(a.removeEventListener)a.removeEventListener("touchmove",o,!1);else if(a.detachEvent)for(var b in h)"touchmove"===h[b].name&&h[b].callback===o&&(a.detachEvent(b),delete h[b])};window.Touchy=l})();
